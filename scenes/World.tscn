[gd_scene load_steps=5 format=3 uid="uid://humr7yriy0kd"]

[sub_resource type="CompressedTexture2D" id="CompressedTexture2D_fkclk"]

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_lgxo1"]
texture = SubResource("CompressedTexture2D_fkclk")
texture_region_size = Vector2i(8, 8)
0:0/0 = 0
1:0/0 = 0
2:0/0 = 0
3:0/0 = 0
4:0/0 = 0
0:1/0 = 0
1:1/0 = 0
2:1/0 = 0
3:1/0 = 0
4:1/0 = 0
0:2/0 = 0
1:2/0 = 0
2:2/0 = 0
3:2/0 = 0
4:2/0 = 0
0:3/0 = 0
1:3/0 = 0
2:3/0 = 0
3:3/0 = 0
4:3/0 = 0
0:4/0 = 0
1:4/0 = 0
2:4/0 = 0
3:4/0 = 0
4:4/0 = 0

[sub_resource type="TileSet" id="TileSet_4sxrq"]
tile_size = Vector2i(8, 8)
sources/0 = SubResource("TileSetAtlasSource_lgxo1")

[sub_resource type="GDScript" id="GDScript_jei7l"]
script/source = "extends TileMap

var fnl := FastNoiseLite.new()

func _ready() -> void:
	randomize()
	fnl.seed = randi()
	fnl.noise_type = FastNoiseLite.TYPE_PERLIN
	fnl.fractal_type = FastNoiseLite.FRACTAL_FBM
	
	generateMap()

func generateMap() -> void:
	for x in 480:
		for y in 270:
			var noiseVal := fnl.get_noise_2d(x * 1, y * 1)
			var biome = Vector2(0, 0)  # Default to ocean

			# Calculate gradient probability for northern and southern biomes
			var north_prob = clamp((25.0 - float(y)) / 25.0, 0.0, 1.0)  # Higher as y approaches 0
			var south_prob = clamp((float(y) - 110.0) / 25.0, 0.0, 1.0)  # Higher as y approaches 135

			# Calculate gradient probability for western and eastern biomes
			var west_prob = clamp((30.0 - float(x)) / 30.0, 0.0, 1.0)  # Higher as x approaches 0
			var east_prob = clamp((float(x) - 210.0) / 30.0, 0.0, 1.0)  # Higher as x approaches 240

			# Northern section for cold biomes
			if y < 25:
				if randf() < north_prob:  # Use the gradient probability for northern biomes
					if noiseVal < -0.25:
						biome = Vector2(4, 1)  # North mountains
					elif noiseVal < -0.10:
						biome = Vector2(3, 1)  # North forest
					elif noiseVal < 0.11:
						biome = Vector2(2, 1)  # North plains
					elif noiseVal < 0.13:
						biome = Vector2(1, 1)  # North coast
					else:
						biome = Vector2(0, 1)  # North ocean
				else:
					biome = select_central_biome(noiseVal)  # Fall back to central biome

			# Southern section for desert biomes
			elif y > 110:
				if randf() < south_prob:  # Use the gradient probability for southern biomes
					if noiseVal < -0.25:
						biome = Vector2(4, 2)  # South mountains
					elif noiseVal < -0.10:
						biome = Vector2(3, 2)  # South forest
					elif noiseVal < 0.11:
						biome = Vector2(2, 2)  # South plains
					elif noiseVal < 0.13:
						biome = Vector2(1, 0)  # South coast
					else:
						biome = Vector2(0, 0)  # South ocean
				else:
					biome = select_central_biome(noiseVal)  # Fall back to central biome

			# Western section for swamp biomes
			elif x < 30 and y >= 25 and y <= 110:
				if randf() < west_prob:  # Use the gradient probability for western biomes
					if noiseVal < -0.25:
						biome = Vector2(4, 3)  # West mountains
					elif noiseVal < -0.10:
						biome = Vector2(3, 3)  # West forest
					elif noiseVal < 0.11:
						biome = Vector2(2, 3)  # West plains
					elif noiseVal < 0.13:
						biome = Vector2(1, 3)  # West coast
					else:
						biome = Vector2(0, 3)  # West ocean
				else:
					biome = select_central_biome(noiseVal)  # Fall back to central biome

			# Eastern section for jungle biomes
			elif x > 210 and y >= 25 and y <= 240:
				if randf() < east_prob:  # Use the gradient probability for eastern biomes
					if noiseVal < -0.25:
						biome = Vector2(4, 4)  # East mountains
					elif noiseVal < -0.10:
						biome = Vector2(3, 4)  # East forest
					elif noiseVal < 0.11:
						biome = Vector2(2, 4)  # East plains
					elif noiseVal < 0.13:
						biome = Vector2(1, 4)  # East coast
					else:
						biome = Vector2(0, 0)  # East ocean
				else:
					biome = select_central_biome(noiseVal)  # Fall back to central biome

			# Central Biomes
			else:
				biome = select_central_biome(noiseVal)

			# Set the tile based on the biome
			set_cell(0, Vector2i(x, y), 0, biome)

func select_central_biome(noiseVal: float) -> Vector2:
	if noiseVal < -0.25:
		return Vector2(4, 0)  # Central mountains
	elif noiseVal < -0.10:
		return Vector2(3, 0)  # Central forest
	elif noiseVal < 0.11:
		return Vector2(2, 0)  # Central plains
	elif noiseVal < 0.13:
		return Vector2(1, 0)  # Central coast
	else:
		return Vector2(0, 0)  # Central ocean

"

[node name="world" type="Node2D"]

[node name="TileMap" type="TileMap" parent="."]
tile_set = SubResource("TileSet_4sxrq")
format = 2
script = SubResource("GDScript_jei7l")
